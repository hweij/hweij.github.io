(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();async function u(){if(console.log("Running in production mode: loading service worker"),"serviceWorker"in navigator)try{const o=await navigator.serviceWorker.register("./sw.js");return o.installing?console.log("Service worker installing"):o.waiting?console.log("Service worker installed"):o.active&&console.log("Service worker active"),o}catch(o){console.error(`Registration failed with ${o}`)}}function x(o){return new ReadableStream({start(e){e.enqueue(o),e.close()}})}async function f(o,e){const t=o.getReader();let n=!1;const i=[];for(;!n;){const a=await t.read();n=a.done,a.value&&i.push(a.value)}return new Blob(i,{type:e})}function c(o,e,t){const n=[];for(let i=0;i<t;i++)n.push(String.fromCharCode(o.getUint8(e+i)));return n.join("")}class h{#e;#i=[];#a=[];#t;constructor(e){this.#e=new DataView(e),this.read()}async extract(e){const t=this.#e.buffer.slice(e.startsAt,e.startsAt+e.compressedSize);if(e.compressionMethod===0)return new Blob([t]);if(e.compressionMethod===8){const n=new DecompressionStream("deflate-raw"),a=x(t).pipeThrough(n);return await f(a)}}read(){console.log("***** READ-C *****");let e=this.#e.byteLength-4;for(;e>=0&&this.#e.getUint32(e,!0)!==101010256;)e--;if(e>0){this.#t=this.readEndCentralDirectory(e),console.log(`End of central directory ${e}: CD-offset = ${this.#t.centralDirectoryOffset}`);let t=this.#t.centralDirectoryOffset;for(;;){const n=this.#e.getUint32(t,!0);if(n===33639248){const i=this.readCentralDirectory(t);this.#a.push(i);const a=this.readLocalFile(i),s=i.offset;a.startsAt=s+30+a.fileNameLength+a.extraLength,a.extract=this.extract.bind(this,a),this.#i.push(a),console.log(`Central directory ${t}: file ${i.fileName} at offset ${i.offset}, compressed size = ${i.compressedSize}`),console.log(`Local file ${s}: ${a.fileName}, compressed size = ${a.compressedSize}`),t+=46+i.fileNameLength+i.extraLength+i.fileCommentLength}else if(n===101010256){console.log("Done reading central directories");break}else{console.error(`Unexpected signature while reading central directories: ${n.toString(16)} at index ${t}`);break}}}else console.error("No end of central directory found")}readLocalFile(e){const t=e.offset,n=this.#e.getUint16(t+26,!0),i=this.#e.getUint16(t+28,!0),a=this.#e.getUint16(t+6,!0),s=a&8;return{signature:c(this.#e,t,4),version:this.#e.getUint16(t+4,!0),generalPurpose:a,compressionMethod:this.#e.getUint16(t+8,!0),lastModifiedTime:this.#e.getUint16(t+10,!0),lastModifiedDate:this.#e.getUint16(t+12,!0),crc:s?e.crc:this.#e.getUint32(t+14,!0),compressedSize:s?e.compressedSize:this.#e.getUint32(t+18,!0),uncompressedSize:s?e.uncompressedSize:this.#e.getUint32(t+22,!0),fileNameLength:n,fileName:c(this.#e,t+30,n),extraLength:i,extra:c(this.#e,t+30+n,i)}}readCentralDirectory(e){const t=this.#e.getUint16(e+28,!0),n=this.#e.getUint16(e+30,!0),i=this.#e.getUint16(e+32,!0);return{signature:c(this.#e,e,4),versionCreated:this.#e.getUint16(e+4,!0),versionNeeded:this.#e.getUint16(e+6,!0),generalPurpose:this.#e.getUint16(e+8,!0),compressionMethod:this.#e.getUint16(e+10,!0),lastModifiedTime:this.#e.getUint16(e+12,!0),lastModifiedDate:this.#e.getUint16(e+14,!0),crc:this.#e.getUint32(e+16,!0),compressedSize:this.#e.getUint32(e+20,!0),uncompressedSize:this.#e.getUint32(e+24,!0),fileNameLength:t,extraLength:n,fileCommentLength:i,diskNumber:this.#e.getUint16(e+34,!0),internalAttributes:this.#e.getUint16(e+36,!0),externalAttributes:this.#e.getUint32(e+38,!0),offset:this.#e.getUint32(e+42,!0),fileName:c(this.#e,e+46,t),extra:c(this.#e,e+46+t,n),comments:c(this.#e,e+46+t+n,i)}}readEndCentralDirectory(e){const t=this.#e.getUint16(e+20,!0);return{signature:c(this.#e,e,4),numberOfDisks:this.#e.getUint16(e+4,!0),centralDirectoryStartDisk:this.#e.getUint16(e+6,!0),numberCentralDirectoryRecordsOnThisDisk:this.#e.getUint16(e+8,!0),numberCentralDirectoryRecords:this.#e.getUint16(e+10,!0),centralDirectorySize:this.#e.getUint32(e+12,!0),centralDirectoryOffset:this.#e.getUint32(e+16,!0),commentLength:t,comment:c(this.#e,e+22,t)}}get entries(){return this.#i}}const v={abs:"audio/x-mpeg",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",aim:"application/x-aim",art:"image/x-jg",asf:"video/x-ms-asf",asx:"video/x-ms-asf",au:"audio/basic",avi:"video/x-msvideo",avx:"video/x-rad-screenplay",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",body:"text/html",cdf:"application/x-cdf",cer:"application/pkix-cert",class:"application/java",cpio:"application/x-cpio",csh:"application/x-csh",css:"text/css",dib:"image/bmp",doc:"application/msword",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",eot:"application/vnd.ms-fontobject",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",gif:"image/gif",gtar:"application/x-gtar",gz:"application/x-gzip",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htc:"text/x-component",htm:"text/html",html:"text/html",ief:"image/ief",jad:"text/vnd.sun.j2me.app-descriptor",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",jsf:"text/plain",json:"application/json",jspf:"text/plain",kar:"audio/midi",latex:"application/x-latex",m3u:"audio/x-mpegurl",mac:"image/x-macpaint",man:"text/troff",mathml:"application/mathml+xml",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mif:"application/x-mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp1:"audio/mpeg",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpa:"audio/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpega:"audio/x-mpeg",mpg:"video/mpeg",mpv2:"video/mpeg2",ms:"application/x-wais-source",nc:"application/x-netcdf",oda:"application/oda",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",ogx:"application/ogg",ogv:"video/ogg",oga:"audio/ogg",ogg:"audio/ogg",otf:"application/x-font-opentype",spx:"audio/ogg",flac:"audio/flac",anx:"application/annodex",axa:"audio/annodex",axv:"video/annodex",xspf:"application/xspf+xml",pbm:"image/x-portable-bitmap",pct:"image/pict",pdf:"application/pdf",pgm:"image/x-portable-graymap",pic:"image/pict",pict:"image/pict",pls:"audio/x-scpls",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"text/troff",rtf:"application/rtf",rtx:"text/richtext",sfnt:"application/font-sfnt",sh:"application/x-sh",shar:"application/x-shar",sit:"application/x-stuffit",snd:"audio/basic",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"text/troff",tsv:"text/tab-separated-values",ttf:"application/x-font-ttf",txt:"text/plain",ulw:"audio/basic",ustar:"application/x-ustar",vxml:"application/voicexml+xml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",vsd:"application/vnd.visio",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlsc",wmlscriptc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",woff:"application/font-woff",woff2:"application/font-woff2",wrl:"model/vrml",wspolicy:"application/wspolicy+xml",z:"application/x-compress",zip:"application/zip"};function d(o){const e="application/octet-stream";let t="";const n=o.split(".");return n.length&&(t=n[n.length-1]),t&&v[t.toLowerCase()]||e}function w(o,...e){return String.raw({raw:o},...e)}let m;u().then(o=>{console.log("Service worker registration:"),console.log(o),m=o,b(),p()});const g="el-nido";async function b(){console.log("Installed service worker"),console.log("Caches available:"),console.log(await caches.keys())}async function y(o,e,t){const n=await caches.open(t),i=new Request(o),a=new Headers,s=d(o);a.append("Content-Type",s);const r=new Response(e,{status:200,statusText:"OK",headers:a});await n.put(i,r)}async function U(){const[o]=await window.showOpenFilePicker(),e=await o.getFile();if(console.log(`Selected file: ${e.name}`),e.name.toLowerCase().endsWith(".zip")){const n=e.name.substring(0,e.name.length-4),i=await e.arrayBuffer(),a=new h(i);console.log("Extracted. Entries:"),console.log(a.entries);for(const s of a.entries)if(s.compressedSize>0){const r=d(s.fileName);if(console.log(`File: ${s.fileName}, ${r}`),s.extract){const l=await s.extract();console.log(typeof l),l instanceof Blob&&(console.log("Size = "+l.size),await y(s.fileName,l,n))}}p()}else console.error("Only archives (zip) are supported for local sites.")}const L=document.getElementById("bLoadLocalSite");L.onclick=()=>{console.log("loading.."),U()};const S=document.getElementById("bDelete");S.onclick=()=>{caches.delete(g).then(()=>location.reload())};function D(o){const e=m?.active;e&&e.postMessage(o)}navigator.serviceWorker.addEventListener("message",o=>{switch(console.log(`Message from SW: ${JSON.stringify(o.data)}`),o.data.cmd){case"reload":location.reload();break;case"index":location.href="./index.html";break}});async function p(){const o=document.getElementById("siteList"),e=(await caches.keys()).filter(t=>t!==g);if(e.length){o.innerHTML="";for(const t of e){const n=document.createElement("div");n.className="site-entry",o.appendChild(n);const i=document.createElement("div");i.className="site-button",i.innerHTML=t,i.onclick=()=>{D({cmd:"launch",app:t})};const a=document.createElement("div");a.innerText="x",a.className="delete-button",a.onclick=async()=>{console.log(`Delete site ${t}`),await caches.delete(t),p()},n.append(i,a)}}else k()}function k(){const o=document.getElementById("siteList");o.innerHTML=w`<div>No apps available yet.</div><div>Click the <b>Install app</b> button to install.</div>`}
