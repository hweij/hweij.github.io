(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();async function g(){if(console.log("Running in production mode: loading service worker"),"serviceWorker"in navigator)try{const a=await navigator.serviceWorker.register("./sw.js");return a.installing?console.log("Service worker installing"):a.waiting?console.log("Service worker installed"):a.active&&console.log("Service worker active"),a}catch(a){console.error(`Registration failed with ${a}`)}}function u(a){return new ReadableStream({start(e){e.enqueue(a),e.close()}})}async function x(a,e){const i=a.getReader();let t=!1;const o=[];for(;!t;){const n=await i.read();t=n.done,n.value&&o.push(n.value)}return new Blob(o,{type:e})}function r(a,e,i){const t=[];for(let o=0;o<i;o++)t.push(String.fromCharCode(a.getUint8(e+o)));return t.join("")}class h{#e;#t=0;#i=[];#o=[];#a;constructor(e){this.#e=new DataView(e),this.read()}async extract(e){const i=this.#e.buffer.slice(e.startsAt,e.startsAt+e.compressedSize);if(e.compressionMethod===0)return new Blob([i]);if(e.compressionMethod===8){const t=new DecompressionStream("deflate-raw"),n=u(i).pipeThrough(t);return await x(n)}}read(){for(;!this.#a;){const e=this.#e.getUint32(this.#t,!0),i=`${this.#t.toString(16)}: ${e.toString(16)}`;if(e===67324752){const t=this.readLocalFile(this.#t);t.startsAt=this.#t+30+t.fileNameLength+t.extraLength,t.extract=this.extract.bind(this,t),this.#i.push(t),this.#t=t.startsAt+t.compressedSize,console.log(`Local file ${t.fileName}, compressed size = ${t.compressedSize}`)}else if(e===33639248){const t=this.readCentralDirectory(this.#t);this.#o.push(t),this.#t+=46+t.fileNameLength+t.extraLength+t.fileCommentLength,console.log(`Central directory ${t.fileName}, compressed size = ${t.compressedSize}`)}else if(e===101010256)this.#a=this.readEndCentralDirectory(this.#t),console.log("End of central directory");else throw new Error(`Unexpected signature in zip file: ${i}`)}}readLocalFile(e){const i=this.#e.getUint16(e+26,!0),t=this.#e.getUint16(e+28,!0);return{signature:r(this.#e,e,4),version:this.#e.getUint16(e+4,!0),generalPurpose:this.#e.getUint16(e+6,!0),compressionMethod:this.#e.getUint16(e+8,!0),lastModifiedTime:this.#e.getUint16(e+10,!0),lastModifiedDate:this.#e.getUint16(e+12,!0),crc:this.#e.getUint32(e+14,!0),compressedSize:this.#e.getUint32(e+18,!0),uncompressedSize:this.#e.getUint32(e+22,!0),fileNameLength:i,fileName:r(this.#e,e+30,i),extraLength:t,extra:r(this.#e,e+30+i,t)}}readCentralDirectory(e){const i=this.#e.getUint16(e+28,!0),t=this.#e.getUint16(e+30,!0),o=this.#e.getUint16(e+32,!0);return{signature:r(this.#e,e,4),versionCreated:this.#e.getUint16(e+4,!0),versionNeeded:this.#e.getUint16(e+6,!0),generalPurpose:this.#e.getUint16(e+8,!0),compressionMethod:this.#e.getUint16(e+10,!0),lastModifiedTime:this.#e.getUint16(e+12,!0),lastModifiedDate:this.#e.getUint16(e+14,!0),crc:this.#e.getUint32(e+16,!0),compressedSize:this.#e.getUint32(e+20,!0),uncompressedSize:this.#e.getUint32(e+24,!0),fileNameLength:i,extraLength:t,fileCommentLength:o,diskNumber:this.#e.getUint16(e+34,!0),internalAttributes:this.#e.getUint16(e+36,!0),externalAttributes:this.#e.getUint32(e+38,!0),offset:this.#e.getUint32(42,!0),fileName:r(this.#e,e+46,i),extra:r(this.#e,e+46+i,t),comments:r(this.#e,e+46+i+t,o)}}readEndCentralDirectory(e){const i=this.#e.getUint16(e+20,!0);return{signature:r(this.#e,e,4),numberOfDisks:this.#e.getUint16(e+4,!0),centralDirectoryStartDisk:this.#e.getUint16(e+6,!0),numberCentralDirectoryRecordsOnThisDisk:this.#e.getUint16(e+8,!0),numberCentralDirectoryRecords:this.#e.getUint16(e+10,!0),centralDirectorySize:this.#e.getUint32(e+12,!0),centralDirectoryOffset:this.#e.getUint32(e+16,!0),commentLength:i,comment:r(this.#e,e+22,i)}}get entries(){return this.#i}}const f={abs:"audio/x-mpeg",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",aim:"application/x-aim",art:"image/x-jg",asf:"video/x-ms-asf",asx:"video/x-ms-asf",au:"audio/basic",avi:"video/x-msvideo",avx:"video/x-rad-screenplay",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",body:"text/html",cdf:"application/x-cdf",cer:"application/pkix-cert",class:"application/java",cpio:"application/x-cpio",csh:"application/x-csh",css:"text/css",dib:"image/bmp",doc:"application/msword",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",eot:"application/vnd.ms-fontobject",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",gif:"image/gif",gtar:"application/x-gtar",gz:"application/x-gzip",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htc:"text/x-component",htm:"text/html",html:"text/html",ief:"image/ief",jad:"text/vnd.sun.j2me.app-descriptor",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",jsf:"text/plain",json:"application/json",jspf:"text/plain",kar:"audio/midi",latex:"application/x-latex",m3u:"audio/x-mpegurl",mac:"image/x-macpaint",man:"text/troff",mathml:"application/mathml+xml",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mif:"application/x-mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp1:"audio/mpeg",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpa:"audio/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpega:"audio/x-mpeg",mpg:"video/mpeg",mpv2:"video/mpeg2",ms:"application/x-wais-source",nc:"application/x-netcdf",oda:"application/oda",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",ogx:"application/ogg",ogv:"video/ogg",oga:"audio/ogg",ogg:"audio/ogg",otf:"application/x-font-opentype",spx:"audio/ogg",flac:"audio/flac",anx:"application/annodex",axa:"audio/annodex",axv:"video/annodex",xspf:"application/xspf+xml",pbm:"image/x-portable-bitmap",pct:"image/pict",pdf:"application/pdf",pgm:"image/x-portable-graymap",pic:"image/pict",pict:"image/pict",pls:"audio/x-scpls",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"text/troff",rtf:"application/rtf",rtx:"text/richtext",sfnt:"application/font-sfnt",sh:"application/x-sh",shar:"application/x-shar",sit:"application/x-stuffit",snd:"audio/basic",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"text/troff",tsv:"text/tab-separated-values",ttf:"application/x-font-ttf",txt:"text/plain",ulw:"audio/basic",ustar:"application/x-ustar",vxml:"application/voicexml+xml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",vsd:"application/vnd.visio",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlsc",wmlscriptc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",woff:"application/font-woff",woff2:"application/font-woff2",wrl:"model/vrml",wspolicy:"application/wspolicy+xml",z:"application/x-compress",zip:"application/zip"};function l(a){const e="application/octet-stream";let i="";const t=a.split(".");return t.length&&(i=t[t.length-1]),i&&f[i.toLowerCase()]||e}let m;g().then(a=>{console.log("Service worker registration:"),console.log(a),m=a,w(),d()});const v="el-nido";async function w(){console.log("Installed service worker"),console.log("Caches available:"),console.log(await caches.keys())}async function y(a,e,i){const t=await caches.open(i),o=new Request(a),n=new Headers,s=l(a);n.append("Content-Type",s);const p=new Response(e,{status:200,statusText:"OK",headers:n});await t.put(o,p)}async function b(){const[a]=await window.showOpenFilePicker(),e=await a.getFile();if(console.log(`Selected file: ${e.name}`),e.name.toLowerCase().endsWith(".zip")){const t=e.name.substring(0,e.name.length-4),o=await e.arrayBuffer(),n=new h(o);console.log("Extracted. Entries:"),console.log(n.entries);for(const s of n.entries)if(s.compressedSize>0){const p=l(s.fileName);if(console.log(`File: ${s.fileName}, ${p}`),s.extract){const c=await s.extract();console.log(typeof c),c instanceof Blob&&(console.log("Size = "+c.size),await y(s.fileName,c,t))}}d()}else console.error("Only archives (zip) are supported for local sites.")}const U=document.getElementById("bLoadLocalSite");U.onclick=()=>{console.log("loading.."),b()};const S=document.getElementById("bDelete");S.onclick=()=>{caches.delete(v).then(()=>location.reload())};function L(a){const e=m?.active;e&&e.postMessage(a)}navigator.serviceWorker.addEventListener("message",a=>{switch(console.log(`Message from SW: ${JSON.stringify(a.data)}`),a.data.cmd){case"reload":location.reload();break}});async function d(){const a=document.getElementById("siteList");a.innerHTML="";for(const e of await caches.keys()){const i=document.createElement("div");i.innerHTML=e,i.onclick=()=>{L({cmd:"launch",app:e})},a.appendChild(i)}}
