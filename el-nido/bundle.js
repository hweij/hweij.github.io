(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();async function u(){if(console.log("Running in production mode: loading service worker"),"serviceWorker"in navigator)try{const n=await navigator.serviceWorker.register("./sw.js");return n.installing?console.log("Service worker installing"):n.waiting?console.log("Service worker installed"):n.active&&console.log("Service worker active"),n}catch(n){console.error(`Registration failed with ${n}`)}}function x(n){return new ReadableStream({start(e){e.enqueue(n),e.close()}})}async function f(n,e){const t=n.getReader();let a=!1;const i=[];for(;!a;){const o=await t.read();a=o.done,o.value&&i.push(o.value)}return new Blob(i,{type:e})}function c(n,e,t){const a=[];for(let i=0;i<t;i++)a.push(String.fromCharCode(n.getUint8(e+i)));return a.join("")}class h{#e;#i=[];#a=[];#t;constructor(e){this.#e=new DataView(e),this.read()}async extract(e){const t=this.#e.buffer.slice(e.startsAt,e.startsAt+e.compressedSize);if(e.compressionMethod===0)return new Blob([t]);if(e.compressionMethod===8){const a=new DecompressionStream("deflate-raw"),o=x(t).pipeThrough(a);return await f(o)}}read(){console.log("***** READ-C *****");let e=this.#e.byteLength-4;for(;e>=0&&this.#e.getUint32(e,!0)!==101010256;)e--;if(e>0){this.#t=this.readEndCentralDirectory(e),console.log(`End of central directory ${e}: CD-offset = ${this.#t.centralDirectoryOffset}`);let t=this.#t.centralDirectoryOffset;for(;;){const a=this.#e.getUint32(t,!0);if(a===33639248){const i=this.readCentralDirectory(t);this.#a.push(i);const o=this.readLocalFile(i),s=i.offset;o.startsAt=s+30+o.fileNameLength+o.extraLength,o.extract=this.extract.bind(this,o),this.#i.push(o),console.log(`Central directory ${t}: file ${i.fileName} at offset ${i.offset}, compressed size = ${i.compressedSize}`),console.log(`Local file ${s}: ${o.fileName}, compressed size = ${o.compressedSize}`),t+=46+i.fileNameLength+i.extraLength+i.fileCommentLength}else if(a===101010256){console.log("Done reading central directories");break}else{console.error(`Unexpected signature while reading central directories: ${a.toString(16)} at index ${t}`);break}}}else console.error("No end of central directory found")}readLocalFile(e){const t=e.offset,a=this.#e.getUint16(t+26,!0),i=this.#e.getUint16(t+28,!0),o=this.#e.getUint16(t+6,!0),s=o&8;return{signature:c(this.#e,t,4),version:this.#e.getUint16(t+4,!0),generalPurpose:o,compressionMethod:this.#e.getUint16(t+8,!0),lastModifiedTime:this.#e.getUint16(t+10,!0),lastModifiedDate:this.#e.getUint16(t+12,!0),crc:s?e.crc:this.#e.getUint32(t+14,!0),compressedSize:s?e.compressedSize:this.#e.getUint32(t+18,!0),uncompressedSize:s?e.uncompressedSize:this.#e.getUint32(t+22,!0),fileNameLength:a,fileName:c(this.#e,t+30,a),extraLength:i,extra:c(this.#e,t+30+a,i)}}readCentralDirectory(e){const t=this.#e.getUint16(e+28,!0),a=this.#e.getUint16(e+30,!0),i=this.#e.getUint16(e+32,!0);return{signature:c(this.#e,e,4),versionCreated:this.#e.getUint16(e+4,!0),versionNeeded:this.#e.getUint16(e+6,!0),generalPurpose:this.#e.getUint16(e+8,!0),compressionMethod:this.#e.getUint16(e+10,!0),lastModifiedTime:this.#e.getUint16(e+12,!0),lastModifiedDate:this.#e.getUint16(e+14,!0),crc:this.#e.getUint32(e+16,!0),compressedSize:this.#e.getUint32(e+20,!0),uncompressedSize:this.#e.getUint32(e+24,!0),fileNameLength:t,extraLength:a,fileCommentLength:i,diskNumber:this.#e.getUint16(e+34,!0),internalAttributes:this.#e.getUint16(e+36,!0),externalAttributes:this.#e.getUint32(e+38,!0),offset:this.#e.getUint32(e+42,!0),fileName:c(this.#e,e+46,t),extra:c(this.#e,e+46+t,a),comments:c(this.#e,e+46+t+a,i)}}readEndCentralDirectory(e){const t=this.#e.getUint16(e+20,!0);return{signature:c(this.#e,e,4),numberOfDisks:this.#e.getUint16(e+4,!0),centralDirectoryStartDisk:this.#e.getUint16(e+6,!0),numberCentralDirectoryRecordsOnThisDisk:this.#e.getUint16(e+8,!0),numberCentralDirectoryRecords:this.#e.getUint16(e+10,!0),centralDirectorySize:this.#e.getUint32(e+12,!0),centralDirectoryOffset:this.#e.getUint32(e+16,!0),commentLength:t,comment:c(this.#e,e+22,t)}}get entries(){return this.#i}}const v={abs:"audio/x-mpeg",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",aim:"application/x-aim",art:"image/x-jg",asf:"video/x-ms-asf",asx:"video/x-ms-asf",au:"audio/basic",avi:"video/x-msvideo",avx:"video/x-rad-screenplay",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",body:"text/html",cdf:"application/x-cdf",cer:"application/pkix-cert",class:"application/java",cpio:"application/x-cpio",csh:"application/x-csh",css:"text/css",dib:"image/bmp",doc:"application/msword",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",eot:"application/vnd.ms-fontobject",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",gif:"image/gif",gtar:"application/x-gtar",gz:"application/x-gzip",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htc:"text/x-component",htm:"text/html",html:"text/html",ief:"image/ief",jad:"text/vnd.sun.j2me.app-descriptor",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",jsf:"text/plain",json:"application/json",jspf:"text/plain",kar:"audio/midi",latex:"application/x-latex",m3u:"audio/x-mpegurl",mac:"image/x-macpaint",man:"text/troff",mathml:"application/mathml+xml",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mif:"application/x-mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp1:"audio/mpeg",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpa:"audio/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpega:"audio/x-mpeg",mpg:"video/mpeg",mpv2:"video/mpeg2",ms:"application/x-wais-source",nc:"application/x-netcdf",oda:"application/oda",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",ogx:"application/ogg",ogv:"video/ogg",oga:"audio/ogg",ogg:"audio/ogg",otf:"application/x-font-opentype",spx:"audio/ogg",flac:"audio/flac",anx:"application/annodex",axa:"audio/annodex",axv:"video/annodex",xspf:"application/xspf+xml",pbm:"image/x-portable-bitmap",pct:"image/pict",pdf:"application/pdf",pgm:"image/x-portable-graymap",pic:"image/pict",pict:"image/pict",pls:"audio/x-scpls",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"text/troff",rtf:"application/rtf",rtx:"text/richtext",sfnt:"application/font-sfnt",sh:"application/x-sh",shar:"application/x-shar",sit:"application/x-stuffit",snd:"audio/basic",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"text/troff",tsv:"text/tab-separated-values",ttf:"application/x-font-ttf",txt:"text/plain",ulw:"audio/basic",ustar:"application/x-ustar",vxml:"application/voicexml+xml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",vsd:"application/vnd.visio",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlsc",wmlscriptc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",woff:"application/font-woff",woff2:"application/font-woff2",wrl:"model/vrml",wspolicy:"application/wspolicy+xml",z:"application/x-compress",zip:"application/zip"};function l(n){const e="application/octet-stream";let t="";const a=n.split(".");return a.length&&(t=a[a.length-1]),t&&v[t.toLowerCase()]||e}let d;u().then(n=>{console.log("Service worker registration:"),console.log(n),d=n,w(),g()});const m="el-nido";async function w(){console.log("Installed service worker"),console.log("Caches available:"),console.log(await caches.keys())}async function b(n,e,t){const a=await caches.open(t),i=new Request(n),o=new Headers,s=l(n);o.append("Content-Type",s);const r=new Response(e,{status:200,statusText:"OK",headers:o});await a.put(i,r)}async function y(){const[n]=await window.showOpenFilePicker(),e=await n.getFile();if(console.log(`Selected file: ${e.name}`),e.name.toLowerCase().endsWith(".zip")){const a=e.name.substring(0,e.name.length-4),i=await e.arrayBuffer(),o=new h(i);console.log("Extracted. Entries:"),console.log(o.entries);for(const s of o.entries)if(s.compressedSize>0){const r=l(s.fileName);if(console.log(`File: ${s.fileName}, ${r}`),s.extract){const p=await s.extract();console.log(typeof p),p instanceof Blob&&(console.log("Size = "+p.size),await b(s.fileName,p,a))}}g()}else console.error("Only archives (zip) are supported for local sites.")}const U=document.getElementById("bLoadLocalSite");U.onclick=()=>{console.log("loading.."),y()};const D=document.getElementById("bDelete");D.onclick=()=>{caches.delete(m).then(()=>location.reload())};function S(n){const e=d?.active;e&&e.postMessage(n)}navigator.serviceWorker.addEventListener("message",n=>{switch(console.log(`Message from SW: ${JSON.stringify(n.data)}`),n.data.cmd){case"reload":location.reload();break;case"index":location.href="./index.html";break}});async function g(){const n=document.getElementById("siteList");n.innerHTML="";for(const e of await caches.keys())if(e!==m){const t=document.createElement("div");t.className="site-entry",n.appendChild(t);const a=document.createElement("div");a.className="site-button",a.innerHTML=e,a.onclick=()=>{S({cmd:"launch",app:e})};const i=document.createElement("div");i.innerText="x",i.className="delete-button",i.onclick=async()=>{console.log(`Delete site ${e}`),await caches.delete(e),t.remove()},t.append(a,i)}}
